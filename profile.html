<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="profile.css" />
  <title>Profile</title>
</head>
<body>
  <div class="profile-wrapper">
    <div class="profile-card">
      <img class="background-blur" src="vangogh.png" alt="Fond artistique" />
      <img class="background-preview hidden" alt="Prévisualisation" />

      <div class="section-title badges-title">Badges</div>
      <div class="section-line badges-line"></div>

      <div class="badges-grid">
        <img src="badge/Van Gogh.png" alt="Van Gogh" />
        <img src="badge/Picasso.png" alt="Picasso" />
        <img src="badge/Kahlo.png" alt="Kahlo" />
        <img src="badge/Monnet.png" alt="Monnet" />
        <img src="badge/Vinci.png" alt="Vinci" />
        <img src="badge/Dali.png" alt="Dali" />
      </div>

      <div class="stat-box red">
        <img src="likee.png" alt="Likes" />
        <div>1500</div>
      </div>

      <div class="stat-box yellow">
        <img src="fav2E.png" alt="Favoris" />
        <div>1500</div>
      </div>

      <div class="section-title stats-title">Statistiques</div>
      <div class="section-line stats-line"></div>

      <div class="level">Niv. 1</div>
      <div class="username">Yanaab</div>

      <div class="progress-bar-bg"></div>
      <div class="progress-bar-fill"></div>
      <div class="xp-text">150/200</div>
    </div>


    <div class="edit-button-wrapper">
      <img src="edit.png" alt="Éditer le profil" class="edit-profile-button" />
    </div>



    <div class="edit-profile-form hidden">
      <label for="nameInput">Nom :</label>
      <input type="text" id="nameInput" placeholder="Entrez votre nom" />

<label for="photoInput" class="custom-file-upload">
  <img src="profile.png" alt="Choisir une image" />
</label>
<input type="file" id="photoInput" accept="image/*" />


      <button id="saveProfileBtn">
  Sauvegarder
  <div class="star-1">…</div>
  <div class="star-2">…</div>
  <div class="star-3">…</div>
  <div class="star-4">…</div>
  <div class="star-5">…</div>
  <div class="star-6">…</div>
</button>
    </div>


    <img class="logo" src="Logo.png" alt="Logo" />
    <div class="page-title">Profile</div>
  </div>

  <div class="navbar">
    <a href="trends.html"><img class="icon" src="home.png" alt="Profil" /></a>
    <a href="peinture.html"><img class="icon" src="peinture.png" alt="Peinture" /></a>
    <a href="#"><img class="icon" src="peintre.png" alt="Peintre" /></a>
    <a href="#"><img class="icon" src="museum.png" alt="Musée" /></a>
    <a href="collection.html"><img class="icon" src="fav.png" alt="Favoris" /></a>
    <a href="profile.html" class="home-link"><div class="home-marker"></div><img class="icon home-icon" src="profile.png" alt="Accueil" /></a>
  </div>

  <a href="profile.html"><img class="icon" src="profile.png" alt="Profil" /></a>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const editBtn = document.querySelector(".edit-profile-button");
    const form = document.querySelector(".edit-profile-form");
    const nameInput = document.getElementById("nameInput");
    const photoInput = document.getElementById("photoInput");
    const saveBtn = document.getElementById("saveProfileBtn");
    const usernameDisplay = document.querySelector(".username");
    const backgroundBlur = document.querySelector(".background-blur");
    const wrapper = document.querySelector(".profile-wrapper");

    // ✅ Créer ou récupérer la preview
    let previewImg = document.querySelector(".background-preview");
    if (!previewImg) {
      previewImg = document.createElement("img");
      previewImg.className = "background-preview hidden";
      previewImg.alt = "Prévisualisation du fond";
      previewImg.setAttribute("draggable", "false");
      backgroundBlur.parentElement.appendChild(previewImg);
    }

    // ✅ Styles de la preview
    Object.assign(previewImg.style, {
      position: "absolute",
      top: "-6vh",
      left: "-20vw",
      width: "160vw",
      height: "100vh",
      objectFit: "cover",
      filter: "blur(1.5vh)",
      zIndex: "2",
      opacity: "0.6",
      transition: "opacity 0.3s ease",
      cursor: "grab"
    });

    previewImg.addEventListener("dragstart", (e) => e.preventDefault());

    // ✅ Charger les données sauvegardées
    const savedName = localStorage.getItem("profileName");
    const savedPhoto = localStorage.getItem("profilePhoto");
    const savedTransform = localStorage.getItem("photoTransform");

    if (savedName) usernameDisplay.textContent = savedName;
    if (savedPhoto) backgroundBlur.src = savedPhoto;
    if (savedTransform) backgroundBlur.style.transform = savedTransform;

    // ✅ Afficher le formulaire complet
    editBtn.addEventListener("click", () => {
      form.classList.remove("hidden");
      form.classList.remove("minimal-form");
      nameInput.value = usernameDisplay.textContent;
    });

    // ✅ Mode minimal au choix d’image
    photoInput.addEventListener("change", () => {
      const file = photoInput.files[0];
      if (file && file.type.startsWith("image/")) {
        const reader = new FileReader();
        reader.onload = () => {
          previewImg.src = reader.result;
          previewImg.classList.remove("hidden");
          previewImg.style.transform = "translate(0px, 0px)";
          currentX = 0;
          currentY = 0;

          form.classList.remove("hidden");
          form.classList.add("minimal-form");
        };
        reader.readAsDataURL(file);
      }
    });

    // ✅ Drag pour déplacer l’image
    let isDragging = false;
    let startX = 0;
    let startY = 0;
    let currentX = 0;
    let currentY = 0;

    previewImg.addEventListener("mousedown", (e) => {
      isDragging = true;
      startX = e.clientX - currentX;
      startY = e.clientY - currentY;
      previewImg.style.cursor = "grabbing";
    });

    document.addEventListener("mousemove", (e) => {
      if (!isDragging) return;
      currentX = e.clientX - startX;
      currentY = e.clientY - startY;

      const maxX = window.innerWidth * 0.6;
      const maxY = window.innerHeight * 0.5;

      currentX = Math.max(-maxX, Math.min(currentX, maxX));
      currentY = Math.max(-maxY, Math.min(currentY, maxY));

      previewImg.style.transform = `translate(${currentX}px, ${currentY}px)`;
    });

    document.addEventListener("mouseup", () => {
      isDragging = false;
      previewImg.style.cursor = "grab";
    });

    // ✅ Sauvegarder et restaurer l’interface
    saveBtn.addEventListener("click", () => {
      const newName = nameInput.value.trim();
      if (newName) {
        usernameDisplay.textContent = newName;
        localStorage.setItem("profileName", newName);
      }

      if (previewImg.src) {
        backgroundBlur.src = previewImg.src;
        backgroundBlur.style.transform = previewImg.style.transform;
        localStorage.setItem("profilePhoto", previewImg.src);
        localStorage.setItem("photoTransform", previewImg.style.transform);
        previewImg.classList.add("hidden");

        // ✅ Supprimer le flou derrière le bouton
        saveBtn.style.backdropFilter = "none";
        saveBtn.style.backgroundColor = "transparent";
      }

      form.classList.remove("minimal-form");
      form.classList.add("hidden");
    });
  });
</script>



</body>
</html>
